(this.webpackJsonp=this.webpackJsonp||[]).push([[5],{908:function(e,t,n){"use strict";n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return j})),n.d(t,"c",(function(){return h}));var r=n(17),a=n.n(r),c=n(51),u=n.n(c),o=n(263),i=n(921),s=n(0),l=n(916),f=n(923),m=n.n(f),d=n(911),b=Object(o.none)(),p=Object(o.none)(),g=new l.EventEmitter;function O(){return new Promise((function(e){return p.ifSome(e).ifNone((function(){return g.once("peer",e)}))}))}function j(){var e=Object(s.useState)(p.toJS()),t=a()(e,2),n=t[0],r=t[1];return Object(s.useEffect)((function(){null===n&&O().then(r)}),[n]),n}function h(){var e=Object(s.useState)(b.toJS()),t=a()(e,2),n=t[0],r=t[1];return Object(s.useEffect)((function(){null===n&&new Promise((function(e){return b.ifSome(e).ifNone((function(){return g.once("peer-id",e)}))})).then(r)}),[n]),n}!function(){var e,t;u.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=d.a,n.next=3,u.a.awrap(Object(d.b)());case 3:return n.t1=n.sent,e=(0,n.t0)(n.t1),n.next=7,u.a.awrap(i.Peer.create(new m.a(e)));case 7:(t=n.sent).on("error",(function(e){console.error(e)})),b.replace(e),p.replace(t),g.emit("peer-id",e),g.emit("peer",t);case 13:case"end":return n.stop()}}),null,null,null,Promise)}()},911:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return m}));var r=n(51),a=n.n(r),c=n(263),u=n(938),o="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",i="fishbowl-aicacia-com-";function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return Object(c.range)(0,e).iter().map((function(){return o.charAt(Math.floor(Math.random()*o.length))})).toArray().join("")}function l(e){return i+e}function f(e){return e.substring(i.length)}function m(){var e,t,n=arguments;return a.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:6,r.next=3,a.a.awrap(u.a.getItem("ID"));case 3:if(!(t=r.sent)){r.next=8;break}return r.abrupt("return",t);case 8:return t=s(e),r.next=11,a.a.awrap(u.a.setItem("ID",t));case 11:return r.abrupt("return",t);case 12:case"end":return r.stop()}}),null,null,null,Promise)}},924:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=924},969:function(e){e.exports=JSON.parse('{"a":"41A895CA"}')},997:function(e,t,n){"use strict";n.r(t),n.d(t,"Game",(function(){return fe}));var r=n(0),a=n.n(r),c=n(7),u=n(6),o=n(156),i=n(995),s=n(908),l=n(929),f=n(955),m=n(958),d=n(918),b=n(962),p=Object(d.d)({name:"",team:0,doneWithCards:!1});function g(e){return Object.keys(e).reduce((function(t,n){return t.set(n,function(e){return p({name:e.name,team:e.team})}(e[n]))}),Object(d.b)())}var O,j=Object(d.d)({text:""});function h(e){return j({text:e.text})}function y(e){return Object.keys(e).reduce((function(t,n){var r=e[n];return t.set(n,Object.keys(r).reduce((function(e,t){return e.set(+t,h(r[t]))}),Object(d.b)()))}),Object(d.b)())}function v(e){return Object.keys(e).reduce((function(t,n){return t.set(+n,e[n])}),Object(d.b)())}function E(e){return Object.keys(e).reduce((function(t,n){return t.set(+n,e[n])}),Object(d.b)())}!function(e){e[e.Lobby=0]="Lobby",e[e.Cards=1]="Cards",e[e.Playing=2]="Playing",e[e.Done=3]="Done"}(O||(O={}));var x=Object(d.d)({trust:0,state:O.Lobby,peers:Object(d.b)(),teams:v({0:"Team 1",1:"Team 2"}),cards:Object(d.b)(),cardList:Object(d.c)(),peerList:Object(d.c)(),score:E({0:0,1:0})});function C(e){return x({trust:e.trust,state:e.state,peers:g(e.peers),teams:v(e.teams),cards:y(e.cards),cardList:Object(d.c)(e.cardList.map(h)),peerList:Object(d.c)(e.peerList),score:E(e.cards)})}function I(e,t,n){return e.update("peers",(function(e){return e.set(t,n(e.get(t)||p()))}))}function S(e,t,n,r){return e.update("cards",(function(e){var a=e.get(t,Object(d.b)()),c=a.get(n,j());return e.set(t,a.set(n,r(c)))}))}function w(e,t,n){return e.update("cards",(function(e){var r=e.get(t,Object(d.b)());return e.set(t,r.delete(n))}))}var k=x();var P=Object(l.createStore)(Object(l.combineReducers)({game:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"game.set-name":return I(e,t.peerId,(function(e){return e.set("name",t.name)}));case"game.set-team":return I(e,t.peerId,(function(e){return e.set("team",t.team)}));case"game.set-team-name":return e.update("teams",(function(e){return e.set(t.team,t.name)}));case"game.sync":var n=C(t.state);return n.trust>e.trust?e.mergeDeep(n):n.mergeDeep(e);case"game.set-state":return e.set("state",t.state);case"game.init-round":var r=b.XorShiftRng.fromSeed(t.seed);return e.set("cardList",Object(d.c)(r.shuffle(e.cards.map((function(e){return e.valueSeq().toArray()})).valueSeq().toArray().flat()))).set("peerList",Object(d.c)(r.shuffle(e.peers.keySeq().toArray())));case"game.set-card-text":return S(e,t.peerId,t.index,(function(e){return e.set("text",t.text)}));case"game.set-done-with-cards":return I(e,t.peerId,(function(e){return e.set("doneWithCards",t.doneWithCards)}));case"game.delete-card":return w(e,t.peerId,t.index);case"game.trust":return e.update("trust",(function(e){return e+1}));default:return e}}}),Object(m.composeWithDevTools)()),A=Object(f.createUseReduxStore)(P),L=n(263);function T(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function B(e){return e.game.state}function q(e){return e.game.peers}function J(e){return L.Option.from(e.game.cardList.first())}function N(e){return e.game.peerList.first()}function M(e){return e.game.teams}function W(e){var t=e.game.peers.valueSeq().toArray();if(!t.length)return!1;for(var n,r=T(t);!(n=r()).done;){if(!n.value.doneWithCards)return!1}return!0}var R=n(17),F=n.n(R),U=n(48),_=n(965),G=n(911);function Y(e){K(function(e){return{type:"game.set-state",state:e}}(e))}var z=Object(_.debounce)((function(e,t){K(function(e,t){return{type:"game.set-team-name",name:t,team:e}}(e,t))}),1e3),X=Object(_.debounce)((function(e,t){K(function(e,t){return{type:"game.set-name",peerId:e,name:t}}(e,t))}),1e3);var H=Object(_.debounce)((function(e,t,n){K(function(e,t,n){return{type:"game.set-card-text",peerId:e,index:t,text:n}}(e,t,n))}),1e3);function K(e){P.dispatch(e),Object(s.a)().then((function(t){return t.broadcast(e)}))}Object(s.a)().then((function(e){X(e.getId(),Object(G.c)(e.getId())),e.on("connection",(function(t){var n,r;e.send(t,(n=e.getId(),r=P.getState().game.toJS(),{type:"game.sync",from:n,state:r}))})),e.on("message",(function(e){P.dispatch(e),P.dispatch({type:"game.trust"})}))}));var Q=c.a.create({card:{flexDirection:"row"},cardInput:{flex:11},cardButton:{flex:1,margin:16,justifyContent:"center"}}),V=Object(r.memo)((function(){var e=Object(s.c)(),t=A(W),n=A((function(t){return function(e,t){return e.game.peers.get(t,p()).doneWithCards}(t,e||"")})),c=A((function(t){return function(e,t){return e.game.cards.get(t,Object(d.b)())}(t,e||"")})),o=Object(r.useState)((function(){return c.map((function(e){return e.text})).toList()})),i=F()(o,2),l=i[0],f=i[1];Object(r.useMemo)((function(){return f((function(e){return c.reduce((function(e,t,n){return e.set(n,t.text)}),e)}))}),[c]);var m=function(t){return function(n){e&&H(e,t,n),f((function(e){return e.set(t,n)}))}},b=function(t){return function(){e&&function(e,t){K(function(e,t){return{type:"game.delete-card",peerId:e,index:t}}(e,t))}(e,t),f((function(e){return e.delete(t)}))}},g=Object(r.useCallback)((function(){return f((function(e){return e.push("")}))}),[]),j=Object(r.useCallback)((function(){return e&&function(e,t){K(function(e,t){return{type:"game.set-done-with-cards",peerId:e,doneWithCards:t}}(e,t))}(e,!0)}),[e]),h=Object(r.useCallback)((function(){e&&(K(function(e){return{type:"game.init-round",seed:e}}(Date.now())),Y(O.Playing))}),[e]);return a.a.createElement(u.a,null,l.valueSeq().map((function(e,t){return a.a.createElement(u.a,{key:t,style:Q.card},a.a.createElement(U.Input,{style:Q.cardInput,label:"Card "+(t+1),value:e,onChangeText:m(t)}),a.a.createElement(u.a,{style:Q.cardButton},a.a.createElement(U.Button,{status:"danger",onPress:b(t)},"Delete")))})),a.a.createElement(U.Button,{onPress:g},"Add Card"),!n&&!c.isEmpty()&&a.a.createElement(U.Button,{onPress:j},"Ready"),t&&a.a.createElement(U.Button,{onPress:h},"Start"))})),Z=n(967),$=n.n(Z),ee=n(969);function te(e){return ne(),a.a.createElement(u.a,e,a.a.createElement("google-cast-launcher",null))}var ne=$()((function(){window.__onGCastApiAvailable=function(e,t){e?cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:ee.a,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}):console.error(t)};var e=document.createElement("script");e.src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",document.body.appendChild(e)})),re=Object(r.memo)((function(){var e=Object(s.b)(),t=A(q),n=A(M),c=t.get(e?e.getId():"",p()),u=Object(r.useState)(c.name),o=F()(u,2),i=o[0],l=o[1],f=Object(r.useState)(n),m=F()(f,2),d=m[0],b=m[1],g=t.filter((function(e){return 0===e.team})).toList(),j=t.filter((function(e){return 1===e.team})).toList();Object(r.useMemo)((function(){return b(n)}),[n]);var h=Object(r.useCallback)((function(t){return function(n){e&&(z(t,n),b((function(e){return e.set(t,n)})))}}),[e]),y=Object(r.useCallback)((function(t){e&&(X(e.getId(),t),l(t))}),[e]),v=Object(r.useCallback)((function(t){return function(){e&&function(e,t){K(function(e,t){return{type:"game.set-team",peerId:e,team:t}}(e,t))}(e.getId(),t)}}),[e]),E=Object(r.useCallback)((function(){return Y(O.Cards)}),[]);return a.a.createElement(a.a.Fragment,null,a.a.createElement(U.Input,{label:"Your Name",value:i,onChangeText:y}),a.a.createElement(U.Input,{label:"Team 1 Name",value:d.get(0,""),onChangeText:h(0)}),a.a.createElement(U.Input,{label:"Team 2 Name",value:d.get(1,""),onChangeText:h(1)}),a.a.createElement(U.Divider,null),a.a.createElement(U.CheckBox,{checked:0==c.team,onChange:v(0)},(1==c.team?"Join ":"")+d.get(0,"")),g.toSeq().map((function(e,t){return a.a.createElement(U.Text,{key:t},e.name)})).valueSeq(),a.a.createElement(U.CheckBox,{checked:1==c.team,onChange:v(1)},(0==c.team?"Join ":"")+d.get(1,"")),j.toSeq().map((function(e,t){return a.a.createElement(U.Text,{key:t},e.name)})).valueSeq(),a.a.createElement(U.Button,{disabled:g.isEmpty()||j.isEmpty(),onPress:E},"Start"))})),ae=c.a.create({container:{flex:1,alignItems:"center"}}),ce=Object(r.memo)((function(){var e=Object(s.c)(),t=A(J),n=e===A(N),c=Object(r.useCallback)((function(){return null}),[]),o=Object(r.useCallback)((function(){return null}),[]);return a.a.createElement(u.a,{style:ae.container},n&&a.a.createElement(a.a.Fragment,null,a.a.createElement(U.Text,{category:"h3"},"Your Turn"),t.isSome()&&a.a.createElement(U.Text,{category:"h1"},t.unwrap().text),a.a.createElement(U.Button,{status:"success",onPress:c},"Correct"),a.a.createElement(U.Button,{status:"danger",onPress:o},"Next")))})),ue=n(970),oe=n(52),ie=Object(r.memo)((function(e){var t=Object(r.useState)(),n=F()(t,2),c=n[0],u=n[1],o=e.size||512;return Object(r.useMemo)((function(){Object(ue.toDataURL)(e.uri,{width:o,height:o}).then(u)}),[e.uri,o]),a.a.createElement(oe.a,{source:{uri:c},style:{width:o,height:o}})})),se=n(218),le=c.a.create({qrcode:{flex:1,alignItems:"center"},castButton:{position:"absolute",right:8,top:8,width:32,height:32}});function fe(e){var t=Object(s.b)(),n=A(B),c=Object(o.a)();return Object(r.useMemo)((function(){var n=Object(G.a)(e.id);if(t&&n!==t.getId())try{t.connect(n)}catch(r){}}),[t,e.id]),a.a.createElement(a.a.Fragment,null,n===O.Lobby?a.a.createElement(re,null):n===O.Cards?a.a.createElement(V,null):n===O.Playing?a.a.createElement(ce,null):null,n<O.Playing&&a.a.createElement(u.a,{style:le.qrcode},a.a.createElement(ie,{uri:Object(i.a)("/game/"+e.id),size:Object(se.c)(c.width)?se.b:c.width})),a.a.createElement(te,{style:le.castButton}))}}}]);
//# sourceMappingURL=5.4d414792.chunk.js.map