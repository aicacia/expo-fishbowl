{"version":3,"sources":["src/id.ts","src/peer.ts","node_modules/peerjs/dist sync","src/screens/Home/Home.tsx"],"names":["CHARS","PREFIX","randomId","size","range","iter","map","charAt","Math","floor","random","length","toArray","join","getAppId","id","getIdFromAppId","appId","substring","getId","a","async","AsyncStorage","getItem","setItem","APP_PEER_ID","none","PEER","emitter","EventEmitter","getPeer","Promise","resolve","ifSome","ifNone","once","usePeer","useState","toJS","peer","setPeer","useEffect","then","appPeerId","Peer","create","PeerJS","on","error","console","replace","emit","init","webpackEmptyContext","req","e","Error","code","keys","module","exports","styles","StyleSheet","startNewGame","marginTop","Home","_props","gameId","setGameId","navigation","useNavigation","value","onChangeText","disabled","onPress","navigate","LOBBY_SCREEN","style"],"mappings":"mOAIEA,EAAQ,uCACRC,EAAS,wBAEX,SAASC,IAAoB,IAAXC,EAAU,uDAAH,EACvB,OAAOC,gBAAM,EAAGD,GACbE,OACAC,KAAI,kBAAMN,EAAMO,OAAOC,KAAKC,MAAMD,KAAKE,SAAWV,EAAMW,YACxDC,UACAC,KAAK,IAGH,SAASC,EAASC,GACvB,OAAOd,EAASc,EAGX,SAASC,EAAeC,GAC7B,OAAOA,EAAMC,UAAUjB,EAAOU,QAGzB,SAAeQ,IAAf,6BAAAC,EAAAC,OAAA,uDAAqBlB,EAArB,+BAA4B,EAA5B,WAAAiB,EAAA,MACUE,IAAaC,QArBf,OAoBR,YACDR,EADC,iDAIIA,GAJJ,cAMHA,EAAKb,EAASC,GANX,YAAAiB,EAAA,MAOGE,IAAaE,QA3BR,KA2BwBT,IAPhC,iCAQIA,GARJ,+D,wMChBMU,EAA8BC,iBACzCC,EAAqBD,iBAEjBE,EAAU,IAAIC,eAQb,SAASC,IACd,OAAO,IAAIC,SAAc,SAACC,GAAD,OACvBL,EAAKM,OAAOD,GAASE,QAAO,kBAAMN,EAAQO,KAAK,OAAQH,SAIpD,SAASI,IAAW,IAAD,EACAC,mBAASV,EAAKW,QADd,WACjBC,EADiB,KACXC,EADW,KASxB,OANAC,qBAAU,WACK,OAATF,GACFT,IAAUY,KAAKF,KAEhB,CAACD,IAEGA,GAeT,qBAAAnB,EAAAC,OAAA,4DACoBP,IADpB,WAAAM,EAAA,MACmCD,eADnC,0BACQwB,GADR,yBAAAvB,EAAA,MAEiBwB,OAAKC,OAAO,IAAIC,IAAOH,KAFxC,QAEIJ,EAFJ,QAIOQ,GAAG,SAAS,SAACC,GAChBC,QAAQD,MAAMA,MAGhBvB,EAAYyB,QAAQP,GACpBhB,EAAKuB,QAAQX,GAEbX,EAAQuB,KAAK,UAAWR,GACxBf,EAAQuB,KAAK,OAAQZ,GAZvB,6DAeAa,I,kBC/DA,SAASC,EAAoBC,GAC5B,IAAIC,EAAI,IAAIC,MAAM,uBAAyBF,EAAM,KAEjD,MADAC,EAAEE,KAAO,mBACHF,EAEPF,EAAoBK,KAAO,WAAa,MAAO,IAC/CL,EAAoBrB,QAAUqB,EAC9BM,EAAOC,QAAUP,EACjBA,EAAoBtC,GAAK,K,0KCAnB8C,EAASC,IAAWjB,OAAO,CAC/BkB,aAAc,CACZC,UAAW,MAIR,SAASC,EAAKC,GAAwC,IAAD,EAC9B7B,mBAAS,IADqB,WACnD8B,EADmD,KAC3CC,EAD2C,KAExD7B,EAAOH,cACPiC,EAAaC,0BAEf,OACE,kBAAC,IAAD,KACE,kBAAC,QAAD,CAAOC,MAAOJ,EAAQK,aAAcJ,IACpC,kBAAC,SAAD,CACEK,UAAWN,EAAOxD,OAClB+D,QAAS,kBAAML,EAAWM,SAASC,IAAc,CAAE7D,GAAIoD,MAFzD,aAMC5B,GACC,kBAAC,SAAD,CACEsC,MAAOhB,EAAOE,aACdW,QAAS,kBACPL,EAAWM,SAASC,IAAc,CAChC7D,GAAIC,YAAeuB,EAAKpB,aAJ9B","file":"static/js/8.4f125cab.chunk.js","sourcesContent":["import { range } from \"@aicacia/core\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nconst ID_KEY = \"ID\",\n  CHARS = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\",\n  PREFIX = \"fishbowl-aicacia-com-\";\n\nfunction randomId(size = 6) {\n  return range(0, size)\n    .iter()\n    .map(() => CHARS.charAt(Math.floor(Math.random() * CHARS.length)))\n    .toArray()\n    .join(\"\");\n}\n\nexport function getAppId(id: string) {\n  return PREFIX + id;\n}\n\nexport function getIdFromAppId(appId: string) {\n  return appId.substring(PREFIX.length);\n}\n\nexport async function getId(size = 6) {\n  let id = await AsyncStorage.getItem(ID_KEY);\n\n  if (id) {\n    return id;\n  } else {\n    id = randomId(size);\n    await AsyncStorage.setItem(ID_KEY, id);\n    return id;\n  }\n}\n","import { none, Option } from \"@aicacia/core\";\nimport { Peer } from \"@aicacia/peer\";\nimport { useEffect, useState } from \"react\";\nimport { EventEmitter } from \"events\";\nimport PeerJS from \"peerjs\";\nimport { getId, getAppId } from \"./id\";\n\nexport const APP_PEER_ID: Option<string> = none(),\n  PEER: Option<Peer> = none();\n\nconst emitter = new EventEmitter();\n\nexport function getPeerId() {\n  return new Promise<string>((resolve) =>\n    APP_PEER_ID.ifSome(resolve).ifNone(() => emitter.once(\"peer-id\", resolve))\n  );\n}\n\nexport function getPeer() {\n  return new Promise<Peer>((resolve) =>\n    PEER.ifSome(resolve).ifNone(() => emitter.once(\"peer\", resolve))\n  );\n}\n\nexport function usePeer() {\n  const [peer, setPeer] = useState(PEER.toJS());\n\n  useEffect(() => {\n    if (peer === null) {\n      getPeer().then(setPeer);\n    }\n  }, [peer]);\n\n  return peer;\n}\n\nexport function usePeerId() {\n  const [peerId, setPeerId] = useState(APP_PEER_ID.toJS());\n\n  useEffect(() => {\n    if (peerId === null) {\n      getPeerId().then(setPeerId);\n    }\n  }, [peerId]);\n\n  return peerId;\n}\n\nasync function init() {\n  const appPeerId = getAppId(await getId()),\n    peer = await Peer.create(new PeerJS(appPeerId));\n\n  peer.on(\"error\", (error) => {\n    console.error(error);\n  });\n\n  APP_PEER_ID.replace(appPeerId);\n  PEER.replace(peer);\n\n  emitter.emit(\"peer-id\", appPeerId);\n  emitter.emit(\"peer\", peer);\n}\n\ninit();\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 925;","import React, { useState } from \"react\";\nimport { StyleSheet, View } from \"react-native\";\nimport { Input, Button } from \"@ui-kitten/components\";\nimport { HOME_SCREEN, LOBBY_SCREEN, ParamList } from \"../../navigationConfig\";\nimport { usePeer } from \"../../peer\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { getIdFromAppId } from \"../../id\";\n\nconst styles = StyleSheet.create({\n  startNewGame: {\n    marginTop: 32,\n  },\n});\n\nexport function Home(_props: ParamList[typeof HOME_SCREEN]) {\n  const [gameId, setGameId] = useState(\"\"),\n    peer = usePeer(),\n    navigation = useNavigation();\n\n  return (\n    <View>\n      <Input value={gameId} onChangeText={setGameId} />\n      <Button\n        disabled={!gameId.length}\n        onPress={() => navigation.navigate(LOBBY_SCREEN, { id: gameId })}\n      >\n        Join Game\n      </Button>\n      {peer && (\n        <Button\n          style={styles.startNewGame}\n          onPress={() =>\n            navigation.navigate(LOBBY_SCREEN, {\n              id: getIdFromAppId(peer.getId()),\n            })\n          }\n        >\n          Start New Game\n        </Button>\n      )}\n    </View>\n  );\n}\n"],"sourceRoot":""}