(this.webpackJsonp=this.webpackJsonp||[]).push([[5],{912:function(e,t,n){"use strict";n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return j})),n.d(t,"c",(function(){return h}));var r=n(52),a=n.n(r),c=n(17),u=n.n(c),o=n(264),i=n(923),s=n(0),l=n(917),f=n(924),m=n.n(f),d=n(915),b=Object(o.none)(),p=Object(o.none)(),g=new l.EventEmitter;function O(){return new Promise((function(e){return p.ifSome(e).ifNone((function(){return g.once("peer",e)}))}))}function j(){var e=Object(s.useState)(p.toJS()),t=u()(e,2),n=t[0],r=t[1];return Object(s.useEffect)((function(){null===n&&O().then(r)}),[n]),n}function h(){var e=Object(s.useState)(b.toJS()),t=u()(e,2),n=t[0],r=t[1];return Object(s.useEffect)((function(){null===n&&new Promise((function(e){return b.ifSome(e).ifNone((function(){return g.once("peer-id",e)}))})).then(r)}),[n]),n}!function(){var e,t;a.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=d.a,n.next=3,a.a.awrap(Object(d.b)());case 3:return n.t1=n.sent,e=(0,n.t0)(n.t1),n.next=7,a.a.awrap(i.Peer.create(new m.a(e)));case 7:(t=n.sent).on("error",(function(e){console.error(e)})),b.replace(e),p.replace(t),g.emit("peer-id",e),g.emit("peer",t);case 13:case"end":return n.stop()}}),null,null,null,Promise)}()},915:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return m}));var r=n(52),a=n.n(r),c=n(264),u=n(937),o="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",i="fishbowl-aicacia-com-";function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return Object(c.range)(0,e).iter().map((function(){return o.charAt(Math.floor(Math.random()*o.length))})).toArray().join("")}function l(e){return i+e}function f(e){return e.substring(i.length)}function m(){var e,t,n=arguments;return a.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:6,r.next=3,a.a.awrap(u.a.getItem("ID"));case 3:if(!(t=r.sent)){r.next=8;break}return r.abrupt("return",t);case 8:return t=s(e),r.next=11,a.a.awrap(u.a.setItem("ID",t));case 11:return r.abrupt("return",t);case 12:case"end":return r.stop()}}),null,null,null,Promise)}},925:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=925},966:function(e){e.exports=JSON.parse('{"a":"41A895CA"}')},994:function(e,t,n){"use strict";n.r(t),n.d(t,"Game",(function(){return le}));var r=n(0),a=n.n(r),c=n(6),u=n(5),o=n(159),i=n(992),s=n(912),l=n(930),f=n(920),m=Object(f.Record)({name:"",team:0,doneWithCards:!1});function d(e){return Object.keys(e).reduce((function(t,n){return t.set(n,function(e){return m({name:e.name,team:e.team})}(e[n]))}),Object(f.Map)())}var b,p=Object(f.Record)({text:""});function g(e){return Object.keys(e).reduce((function(t,n){var r=e[n];return t.set(n,Object.keys(r).reduce((function(e,t){return e.set(+t,function(e){return p({text:e.text})}(r[t]))}),Object(f.Map)()))}),Object(f.Map)())}function O(e){return Object.keys(e).reduce((function(t,n){return t.set(+n,e[n])}),Object(f.Map)())}!function(e){e[e.Lobby=0]="Lobby",e[e.Cards=1]="Cards",e[e.Playing=2]="Playing",e[e.Done=3]="Done"}(b||(b={}));var j=Object(f.Record)({state:b.Cards,peers:Object(f.Map)(),teams:O({0:"Team 1",1:"Team 2"}),cards:Object(f.Map)()});function h(e){return j({state:e.state,peers:d(e.peers),teams:O(e.teams),cards:g(e.cards)})}var y=j(),v=Object(l.createActionWithPayload)("game.sync"),C=Object(l.createActionWithPayload)("game.set-state"),E=Object(l.createActionWithPayload)("game.set-name"),w=Object(l.createActionWithPayload)("game.set-team"),x=Object(l.createActionWithPayload)("game.set-team-name"),I=Object(l.createActionWithPayload)("game.set-card-text"),S=Object(l.createActionWithPayload)("game.set-done-with-cards");function P(e,t,n){return e.update("peers",(function(e){return e.set(t,n(e.get(t)||m()))}))}var k=n(11),A=n.n(k),M=n(958),T=new l.State(A()({},"game",y),A()({},"game",h)),W=(Object(M.createConnect)(T),Object(M.createHook)(T)),D=Object(l.createDispatcher)(T,Object(l.mergeReducers)(A()({},"game",(function(e,t){if(E.is(t))return P(e,t.payload.id,(function(e){return e.set("name",t.payload.name)}));if(w.is(t))return P(e,t.payload.id,(function(e){return e.set("team",t.payload.team)}));if(x.is(t))return e.update("teams",(function(e){return e.set(t.payload.team,t.payload.name)}));if(v.is(t)){var n=h(t.payload.state);return n.peers.size>e.peers.size?e.mergeDeep(n):n.mergeDeep(e)}return C.is(t)?e.set("state",t.payload):I.is(t)?function(e,t,n,r){return e.update("cards",(function(e){var a=e.get(t,Object(f.Map)()),c=a.get(n,p());return e.set(t,a.set(n,r(c)))}))}(e,t.payload.peerId,t.payload.index,(function(e){return e.set("text",t.payload.text)})):S.is(t)?P(e,t.payload.peerId,(function(e){return e.set("doneWithCards",t.payload.doneWithCards)})):e}))));Object(s.a)().then((function(e){e.on("message",D)}));var J=n(962),N=n(915);function L(e){_(C.create(e))}var q=Object(J.debounce)((function(e,t){_(x.create({team:e,name:t}))}),1e3),B=Object(J.debounce)((function(e,t){_(E.create({id:e,name:t}))}),1e3);var R=Object(J.debounce)((function(e,t,n){_(I.create({peerId:e,index:t,text:n}))}),1e3);function _(e){D(e),Object(s.a)().then((function(t){return t.broadcast(e)}))}function z(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return F(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function U(e){return e.game.state}function G(e){return e.game.peers}function H(e){return e.game.teams}function Y(e){var t=e.game.peers.valueSeq().toArray();if(!t.length)return!1;for(var n,r=z(t);!(n=r()).done;){if(!n.value.doneWithCards)return!1}return!0}Object(s.a)().then((function(e){B(e.getId(),Object(N.c)(e.getId())),e.on("connection",(function(t){e.send(t,v.create({from:e.getId(),state:T.getCurrent().game.toJS()}))}))}));var K=n(17),Q=n.n(K),V=n(48),X=Object(r.memo)((function(){var e=Object(s.c)(),t=W((function(t){return function(e,t){return e.game.peers.get(t,m()).doneWithCards}(t,e||"")})),n=W((function(t){return function(e,t){return e.game.cards.get(t,Object(f.Map)())}(t,e||"")})),c=Object(r.useState)((function(){return n.map((function(e){return e.text})).toList()})),o=Q()(c,2),i=o[0],l=o[1];Object(r.useMemo)((function(){return l((function(e){return n.reduce((function(e,t,n){return e.set(n,t.text)}),e)}))}),[n]);var d=function(t){return function(n){e&&R(e,t,n),l((function(e){return e.set(t,n)}))}},b=Object(r.useCallback)((function(){return l((function(e){return e.push("")}))}),[]),p=Object(r.useCallback)((function(){return e&&function(e,t){_(S.create({peerId:e,doneWithCards:t}))}(e,!0)}),[e]);return a.a.createElement(u.a,null,i.valueSeq().map((function(e,t){return a.a.createElement(V.Input,{key:t,label:"Card "+(t+1),value:e,onChangeText:d(t)})})),a.a.createElement(V.Button,{onPress:b},"Add"),a.a.createElement(V.Button,{disabled:t||n.size<3,onPress:p},"Ready"))})),Z=n(964),$=n.n(Z),ee=n(966);function te(e){return ne(),a.a.createElement(u.a,e,a.a.createElement("google-cast-launcher",null))}var ne=$()((function(){window.__onGCastApiAvailable=function(e,t){e?cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:ee.a,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}):console.error(t)};var e=document.createElement("script");e.src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",document.body.appendChild(e)})),re=Object(r.memo)((function(){var e=Object(s.b)(),t=W(G),n=W(H),c=t.get(e?e.getId():"",m()),u=Object(r.useState)(c.name),o=Q()(u,2),i=o[0],l=o[1],f=Object(r.useState)(n),d=Q()(f,2),p=d[0],g=d[1],O=t.filter((function(e){return 0===e.team})).toList(),j=t.filter((function(e){return 1===e.team})).toList();Object(r.useMemo)((function(){return g(n)}),[n]);var h=Object(r.useCallback)((function(t){return function(n){e&&(q(t,n),g((function(e){return e.set(t,n)})))}}),[e]),y=Object(r.useCallback)((function(t){e&&(B(e.getId(),t),l(t))}),[e]),v=Object(r.useCallback)((function(t){return function(){e&&function(e,t){_(w.create({id:e,team:t}))}(e.getId(),t)}}),[e]),C=Object(r.useCallback)((function(){return L(b.Cards)}),[]);return a.a.createElement(a.a.Fragment,null,a.a.createElement(V.Input,{label:"Your Name",value:i,onChangeText:y}),a.a.createElement(V.Input,{label:"Team 1 Name",value:p.get(0,""),onChangeText:h(0)}),a.a.createElement(V.Input,{label:"Team 2 Name",value:p.get(1,""),onChangeText:h(1)}),a.a.createElement(V.Divider,null),a.a.createElement(V.CheckBox,{checked:0==c.team,onChange:v(0)},(1==c.team?"Join ":"")+p.get(0,"")),O.toSeq().map((function(e,t){return a.a.createElement(V.Text,{key:t},e.name)})).valueSeq(),a.a.createElement(V.CheckBox,{checked:1==c.team,onChange:v(1)},(0==c.team?"Join ":"")+p.get(1,"")),j.toSeq().map((function(e,t){return a.a.createElement(V.Text,{key:t},e.name)})).valueSeq(),a.a.createElement(V.Button,{disabled:O.isEmpty()||j.isEmpty(),onPress:C},"Start"))})),ae=Object(r.memo)((function(){return a.a.createElement(u.a,null,a.a.createElement(V.Text,null,"Playing"))})),ce=n(967),ue=n(53),oe=Object(r.memo)((function(e){var t=Object(r.useState)(),n=Q()(t,2),c=n[0],u=n[1],o=e.size||512;return Object(r.useMemo)((function(){Object(ce.toDataURL)(e.uri,{width:o,height:o}).then(u)}),[e.uri,o]),a.a.createElement(ue.a,{source:{uri:c},style:{width:o,height:o}})})),ie=n(220),se=c.a.create({qrcode:{flex:1,alignItems:"center"},castButton:{position:"absolute",right:8,top:8,width:32,height:32}});function le(e){var t=Object(s.b)(),n=W(Y),c=W(U),l=Object(o.a)();return Object(r.useMemo)((function(){var n=Object(N.a)(e.id);if(t&&n!==t.getId())try{t.connect(n)}catch(r){}}),[t,e.id]),n&&c!==b.Playing&&L(b.Playing),a.a.createElement(a.a.Fragment,null,c===b.Lobby?a.a.createElement(re,null):c===b.Cards?a.a.createElement(X,null):c===b.Playing?a.a.createElement(ae,null):null,a.a.createElement(u.a,{style:se.qrcode},a.a.createElement(oe,{uri:Object(i.a)("/game/"+e.id),size:Object(ie.c)(l.width)?ie.b:l.width})),a.a.createElement(te,{style:se.castButton}))}}}]);
//# sourceMappingURL=5.7eaaed8a.chunk.js.map